{
  "dashboard": {
    "id": null,
    "title": "Kyverno RDS Testing Strategy Dashboard",
    "tags": ["kyverno", "rds", "testing", "strategy"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "Phase 1: RDS Database Status",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT CASE WHEN count(*) > 0 THEN 1 ELSE 0 END as status FROM pg_stat_activity WHERE state = 'active';",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {"options": {"0": {"text": "❌ Disconnected"}}, "type": "value"},
              {"options": {"1": {"text": "✅ Connected"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 2,
        "title": "Phase 1: Kyverno Status",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            },
            "expr": "up{container=\"kyverno\"}",
            "legendFormat": "Kyverno Pods"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {"options": {"0": {"text": "❌ Down"}}, "type": "value"},
              {"options": {"1": {"text": "✅ Running"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 3,
        "title": "Phase 2: Reports Server Status",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            },
            "expr": "up{container=\"reports-server\"}",
            "legendFormat": "Reports Server"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {"options": {"0": {"text": "❌ Not Installed"}}, "type": "value"},
              {"options": {"1": {"text": "✅ Running"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 4,
        "title": "Database Connectivity Test",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT count(*) as active_connections FROM pg_stat_activity WHERE state = 'active';",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
      },
      {
        "id": 5,
        "title": "Policy Reports Success Rate",
        "type": "timeseries",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            },
            "expr": "sum(rate(kyverno_admission_requests_total{request_allowed=\"true\"}[5m]))",
            "legendFormat": "Pass"
          },
          {
            "refId": "B",
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            },
            "expr": "sum(rate(kyverno_admission_requests_total{request_allowed=\"false\"}[5m]))",
            "legendFormat": "Fail"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "barAlignment": 0,
              "lineWidth": 1,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": false,
              "showPoints": "never",
              "pointSize": 5,
              "stacking": {
                "mode": "none",
                "group": "A"
              },
              "axisLabel": "",
              "scaleDistribution": {
                "type": "linear"
              },
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "vis": false
              }
            },
            "unit": "reqps"
          }
        }
      },
      {
        "id": 6,
        "title": "Reports Storage Success",
        "type": "timeseries",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT count(*) as total_reports FROM policyreports;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
      },
      {
        "id": 7,
        "title": "Validation Checklist",
        "type": "table",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT 'RDS Instance Available' as check_item, CASE WHEN count(*) > 0 THEN '✅ PASS' ELSE '❌ FAIL' END as status FROM pg_stat_activity UNION ALL SELECT 'Database Credentials Correct' as check_item, CASE WHEN current_database() = 'reportsdb' THEN '✅ PASS' ELSE '❌ FAIL' END as status UNION ALL SELECT 'Reports Server Connected' as check_item, CASE WHEN count(*) > 0 THEN '✅ PASS' ELSE '❌ FAIL' END as status FROM pg_stat_activity WHERE application_name LIKE '%reports%' UNION ALL SELECT 'Policy Reports Table Exists' as check_item, CASE WHEN EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'policyreports') THEN '✅ PASS' ELSE '❌ FAIL' END as status;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 24}
      },
      {
        "id": 8,
        "title": "Database Tables Overview",
        "type": "table",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT 'policyreports' as table_name, count(*) as row_count FROM policyreports UNION ALL SELECT 'ephemeralreports' as table_name, count(*) as row_count FROM ephemeralreports UNION ALL SELECT 'clusterpolicyreports' as table_name, count(*) as row_count FROM clusterpolicyreports UNION ALL SELECT 'clusterephemeralreports' as table_name, count(*) as row_count FROM clusterephemeralreports;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32}
      },
      {
        "id": 9,
        "title": "System Health Score",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT (CASE WHEN count(*) > 0 THEN 25 ELSE 0 END + CASE WHEN current_database() = 'reportsdb' THEN 25 ELSE 0 END + CASE WHEN EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'policyreports') THEN 25 ELSE 0 END + CASE WHEN (SELECT count(*) FROM policyreports) > 0 THEN 25 ELSE 0 END) as health_score;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "orange", "value": 50},
                {"color": "yellow", "value": 75},
                {"color": "green", "value": 100}
              ]
            },
            "unit": "percent",
            "mappings": [
              {"options": {"0": {"text": "❌ 0% - Critical"}}, "type": "value"},
              {"options": {"25": {"text": "⚠️ 25% - Poor"}}, "type": "value"},
              {"options": {"50": {"text": "⚠️ 50% - Fair"}}, "type": "value"},
              {"options": {"75": {"text": "✅ 75% - Good"}}, "type": "value"},
              {"options": {"100": {"text": "✅ 100% - Excellent"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 10,
        "title": "Total Policy Reports Count",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT (SELECT count(*) FROM policyreports) + (SELECT count(*) FROM ephemeralreports) + (SELECT count(*) FROM clusterpolicyreports) + (SELECT count(*) FROM clusterephemeralreports) as total_policy_reports;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "orange", "value": 100},
                {"color": "yellow", "value": 500},
                {"color": "green", "value": 1000}
              ]
            },
            "unit": "short",
            "mappings": [
              {"options": {"0": {"text": "❌ No Reports"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 11,
        "title": "Database Size Usage %",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT ROUND((pg_database_size('reportsdb')::numeric / 2147483648.0 * 100), 2) as memory_allocation_percent;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40},
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 50},
                {"color": "orange", "value": 75},
                {"color": "red", "value": 90}
              ]
            },
            "unit": "percent",
            "mappings": [
              {"options": {"0": {"text": "✅ Optimal"}}, "type": "value"}
            ]
          }
        }
      },
      {
        "id": 12,
        "title": "Policy Reports by Type",
        "type": "piechart",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT 'Policy Reports' as report_type, count(*) as count FROM policyreports UNION ALL SELECT 'Ephemeral Reports' as report_type, count(*) as count FROM ephemeralreports UNION ALL SELECT 'Cluster Policy Reports' as report_type, count(*) as count FROM clusterpolicyreports UNION ALL SELECT 'Cluster Ephemeral Reports' as report_type, count(*) as count FROM clusterephemeralreports;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "vis": false
              }
            }
          }
        }
      },
      {
        "id": 13,
        "title": "Database Size",
        "type": "stat",
        "targets": [
          {
            "refId": "A",
            "datasource": {
              "type": "grafana-postgresql-datasource",
              "uid": "PCC52D03280B7034C"
            },
            "rawQuery": true,
            "rawSql": "SELECT pg_database_size('reportsdb') as database_size_bytes;",
            "format": "table"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "linear",
              "barAlignment": 0,
              "lineWidth": 1,
              "fillOpacity": 10,
              "gradientMode": "none",
              "spanNulls": false,
              "showPoints": "never",
              "pointSize": 5,
              "stacking": {
                "mode": "none",
                "group": "A"
              },
              "axisLabel": "",
              "scaleDistribution": {
                "type": "linear"
              },
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "vis": false
              }
            },
            "unit": "bytes"
          }
        }
      }
    ],
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "refresh": "30s"
  }
}
